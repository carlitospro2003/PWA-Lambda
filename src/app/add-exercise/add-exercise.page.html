<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="'/room-exercises/' + roomId"></ion-back-button>
    </ion-buttons>
    <ion-title>Agregar Ejercicio</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="resetForm()" color="medium">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="add-exercise-content">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Agregar Ejercicio</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="add-exercise-container">

    <form [formGroup]="exerciseForm" (ngSubmit)="saveExercise()">

      <!-- Información Básica -->
      <ion-card class="form-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="information-circle-outline" class="section-icon"></ion-icon>
            Información Básica
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            
            <!-- Nombre del Ejercicio -->
            <ion-item class="form-item" [class.error]="hasError('EXC_Title')">
              <ion-label position="stacked">Título del Ejercicio *</ion-label>
              <ion-input 
                formControlName="EXC_Title"
                placeholder="ej. Burpees, Sentadillas, etc."
                clearInput="true">
              </ion-input>
              <div class="error-message" *ngIf="hasError('EXC_Title')">
                {{ getErrorMessage('EXC_Title') }}
              </div>
            </ion-item>

            <!-- Tipo de Ejercicio -->
            <ion-item class="form-item">
              <ion-label position="stacked">Tipo de Ejercicio</ion-label>
              <ion-select formControlName="EXC_Type" placeholder="Selecciona tipo (opcional)">
                <ion-select-option *ngFor="let type of exerciseTypes" [value]="type.value">
                  {{ type.label }}
                </ion-select-option>
              </ion-select>
            </ion-item>

            <!-- Nivel de Dificultad -->
            <ion-item class="form-item">
              <ion-label position="stacked">Nivel de Dificultad</ion-label>
              <ion-select formControlName="EXC_DifficultyLevel" placeholder="Selecciona dificultad (opcional)">
                <ion-select-option *ngFor="let level of difficultyLevels" [value]="level.value">
                  {{ level.label }}
                </ion-select-option>
              </ion-select>
            </ion-item>

            <!-- Instrucciones -->
            <ion-item class="form-item">
              <ion-label position="stacked">Instrucciones</ion-label>
              <ion-textarea 
                formControlName="EXC_Instructions"
                placeholder="Describe las instrucciones paso a paso... (opcional)"
                rows="4"
                maxlength="5000"
                counter="true">
              </ion-textarea>
            </ion-item>

          </ion-list>
        </ion-card-content>
      </ion-card>

      <!-- Archivos Multimedia -->
      <ion-card class="form-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="camera-outline" class="section-icon"></ion-icon>
            Multimedia (Opcional)
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>

            <ion-grid>
              <ion-row>
                
                <!-- Media 1 -->
                <ion-col size="12" size-md="6">
                  <ion-item class="form-item file-item">
                    <ion-label position="stacked">Imagen/Video 1</ion-label>
                    <div class="file-input-container">
                      <input 
                        type="file" 
                        accept="image/jpeg,image/png,image/jpg,image/webp,video/mp4,video/mov"
                        data-field="EXC_Media1"
                        (change)="onFileSelected($event, 'EXC_Media1')"
                        class="file-input">
                      <ion-button fill="outline" size="small" class="file-button">
                        <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
                        Seleccionar
                      </ion-button>
                      <ion-note class="file-name">{{ getFileName('EXC_Media1') }}</ion-note>
                      <ion-button 
                        *ngIf="hasFile('EXC_Media1')"
                        fill="clear" 
                        size="small" 
                        color="danger"
                        (click)="removeFile('EXC_Media1')">
                        <ion-icon name="close-outline"></ion-icon>
                      </ion-button>
                    </div>
                  </ion-item>
                </ion-col>

                <!-- Media 2 -->
                <ion-col size="12" size-md="6">
                  <ion-item class="form-item file-item">
                    <ion-label position="stacked">Imagen/Video 2</ion-label>
                    <div class="file-input-container">
                      <input 
                        type="file" 
                        accept="image/jpeg,image/png,image/jpg,image/webp,video/mp4,video/mov"
                        data-field="EXC_Media2"
                        (change)="onFileSelected($event, 'EXC_Media2')"
                        class="file-input">
                      <ion-button fill="outline" size="small" class="file-button">
                        <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
                        Seleccionar
                      </ion-button>
                      <ion-note class="file-name">{{ getFileName('EXC_Media2') }}</ion-note>
                      <ion-button 
                        *ngIf="hasFile('EXC_Media2')"
                        fill="clear" 
                        size="small" 
                        color="danger"
                        (click)="removeFile('EXC_Media2')">
                        <ion-icon name="close-outline"></ion-icon>
                      </ion-button>
                    </div>
                  </ion-item>
                </ion-col>

              </ion-row>
              <ion-row>

                <!-- Media 3 -->
                <ion-col size="12" size-md="6">
                  <ion-item class="form-item file-item">
                    <ion-label position="stacked">Imagen/Video 3</ion-label>
                    <div class="file-input-container">
                      <input 
                        type="file" 
                        accept="image/jpeg,image/png,image/jpg,image/webp,video/mp4,video/mov"
                        data-field="EXC_Media3"
                        (change)="onFileSelected($event, 'EXC_Media3')"
                        class="file-input">
                      <ion-button fill="outline" size="small" class="file-button">
                        <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
                        Seleccionar
                      </ion-button>
                      <ion-note class="file-name">{{ getFileName('EXC_Media3') }}</ion-note>
                      <ion-button 
                        *ngIf="hasFile('EXC_Media3')"
                        fill="clear" 
                        size="small" 
                        color="danger"
                        (click)="removeFile('EXC_Media3')">
                        <ion-icon name="close-outline"></ion-icon>
                      </ion-button>
                    </div>
                  </ion-item>
                </ion-col>

                <!-- Media 4 -->
                <ion-col size="12" size-md="6">
                  <ion-item class="form-item file-item">
                    <ion-label position="stacked">Imagen/Video 4</ion-label>
                    <div class="file-input-container">
                      <input 
                        type="file" 
                        accept="image/jpeg,image/png,image/jpg,image/webp,video/mp4,video/mov"
                        data-field="EXC_Media4"
                        (change)="onFileSelected($event, 'EXC_Media4')"
                        class="file-input">
                      <ion-button fill="outline" size="small" class="file-button">
                        <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
                        Seleccionar
                      </ion-button>
                      <ion-note class="file-name">{{ getFileName('EXC_Media4') }}</ion-note>
                      <ion-button 
                        *ngIf="hasFile('EXC_Media4')"
                        fill="clear" 
                        size="small" 
                        color="danger"
                        (click)="removeFile('EXC_Media4')">
                        <ion-icon name="close-outline"></ion-icon>
                      </ion-button>
                    </div>
                  </ion-item>
                </ion-col>

              </ion-row>
            </ion-grid>

          </ion-list>
        </ion-card-content>
      </ion-card>

      <!-- URLs Externas -->
      <ion-card class="form-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="link-outline" class="section-icon"></ion-icon>
            URLs Externas (Opcional)
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>

            <!-- URL 1 -->
            <ion-item class="form-item">
              <ion-icon name="link-outline" slot="start" class="field-icon"></ion-icon>
              <ion-label position="stacked">URL de Video 1 (YouTube, Vimeo, etc.)</ion-label>
              <ion-input 
                formControlName="EXC_URL1"
                type="url"
                placeholder="https://www.youtube.com/watch?v=..."
                clearInput="true">
              </ion-input>
            </ion-item>

            <!-- URL 2 -->
            <ion-item class="form-item">
              <ion-icon name="link-outline" slot="start" class="field-icon"></ion-icon>
              <ion-label position="stacked">URL de Video 2</ion-label>
              <ion-input 
                formControlName="EXC_URL2"
                type="url"
                placeholder="https://..."
                clearInput="true">
              </ion-input>
            </ion-item>

          </ion-list>
        </ion-card-content>
      </ion-card>

      <!-- Botones de Acción -->
      <div class="actions-section">
        <ion-button 
          expand="block" 
          type="submit"
          color="primary"
          size="large"
          [disabled]="isLoading"
          class="save-btn">
          <ion-icon name="save-outline" slot="start"></ion-icon>
          <span *ngIf="!isLoading">Crear Ejercicio</span>
          <span *ngIf="isLoading">Creando...</span>
        </ion-button>

        <ion-button 
          expand="block" 
          fill="outline"
          color="medium"
          size="large"
          (click)="cancelCreation()"
          [disabled]="isLoading"
          class="cancel-btn">
          Cancelar
        </ion-button>
      </div>

    </form>

  </div>
</ion-content>