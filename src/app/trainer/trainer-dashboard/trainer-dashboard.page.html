<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Dashboard - Entrenador</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="goToProfile()">
        <ion-icon name="person-circle-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="trainer-content">
  <div class="trainer-container">
    
    <!-- Nombre del entrenador -->
    <div class="trainer-name-section">
      <h1 class="trainer-name">{{ trainerName }}</h1>
    </div>

    <!-- Etiqueta de Salas -->
    <div class="salas-section">
      <h2 class="salas-title">Salas</h2>
    </div>

        <!-- Botón Agregar Nueva Sala -->
    <div class="add-room-section">
      <ion-button 
        expand="block" 
        size="large"
        class="add-room-button"
        (click)="createNewRoom()">
        <ion-icon name="add" slot="start"></ion-icon>
        Agregar Nueva Sala
      </ion-button>
    </div>

    <!-- Loading de salas -->
    <div *ngIf="isLoadingRooms" class="loading-container">
      <ion-card>
        <ion-card-content>
          <p>Cargando salas...</p>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Cards de Salas -->
    <div class="rooms-grid" *ngIf="!isLoadingRooms">
      <!-- Mensaje cuando no hay salas -->
      <div *ngIf="rooms.length === 0" class="no-rooms-message">
        <ion-card>
          <ion-card-content>
            <p>No tienes salas creadas aún. ¡Crea tu primera sala!</p>
          </ion-card-content>
        </ion-card>
      </div>

      <!-- Lista de salas -->
      <ion-card 
        class="room-card" 
        *ngFor="let room of rooms"
        (click)="viewRoomDetail(room)">
        <ion-card-content>
          
          <!-- Nombre de la sala con botón de editar -->
          <div class="room-header">
            <h3 class="room-name">{{ room.name }}</h3>
            <div class="room-actions">
              <ion-button 
                fill="clear" 
                size="small" 
                (click)="openEditModal(room, $event)"
                class="edit-button">
                <ion-icon name="create-outline" slot="icon-only"></ion-icon>
              </ion-button>
              <ion-button 
                fill="clear" 
                size="small" 
                (click)="confirmDeleteRoom(room, $event)"
                class="delete-button">
                <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
          
          <!-- Información de la sala -->
          <div class="room-info">
            
            <!-- Código de la sala -->
            <div class="info-item">
              <ion-icon name="list-outline" class="info-icon"></ion-icon>
              <div class="info-content">
                <span class="info-label">Código</span>
                <span class="info-value">{{ room.code }}</span>
              </div>
            </div>
            
            <!-- Cantidad de gente -->
            <div class="info-item">
              <ion-icon name="people-outline" class="info-icon"></ion-icon>
              <div class="info-content">
                <span class="info-label">Miembros</span>
                <span class="info-value">{{ room.activeMembers }}</span>
              </div>
            </div>
            
            <!-- Cantidad de ejercicios -->
            <div class="info-item">
              <ion-icon name="list-outline" class="info-icon"></ion-icon>
              <div class="info-content">
                <span class="info-label">Ejercicios</span>
                <span class="info-value">{{ room.totalExercises }}</span>
              </div>
            </div>
            
          </div>
        </ion-card-content>
      </ion-card>
    </div>



  </div>
</ion-content>

<!-- Modal para crear nueva sala -->
<ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Crear Nueva Sala</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeModal()">
            <ion-icon name="close" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="modal-content">
      <div class="modal-container">
        <form (ngSubmit)="createRoom()" #roomForm="ngForm">
          
          <!-- Nombre de la sala -->
          <ion-item class="form-input" lines="none">
            <ion-label position="stacked">Nombre de la Sala *</ion-label>
            <ion-input 
              type="text" 
              [(ngModel)]="newRoom.name" 
              name="roomName"
              placeholder="Ej: Grupo Principiantes"
              required
              maxlength="50">
            </ion-input>
          </ion-item>

          <!-- Botones de acción -->
          <div class="modal-actions">
            <ion-button 
              expand="block" 
              type="button"
              fill="outline" 
              color="medium"
              (click)="closeModal()"
              class="cancel-button">
              Cancelar
            </ion-button>

            <ion-button 
              expand="block" 
              type="submit"
              [disabled]="!roomForm.valid || isCreating"
              class="create-button">
              <span *ngIf="!isCreating">Crear Sala</span>
              <span *ngIf="isCreating">Creando...</span>
            </ion-button>
          </div>

        </form>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Modal para editar sala -->
<ion-modal [isOpen]="isEditModalOpen" (didDismiss)="closeEditModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Editar Sala</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeEditModal()">
            <ion-icon name="close" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="modal-content">
      <div class="modal-container">
        <form (ngSubmit)="updateRoom()" #editRoomForm="ngForm">
          
          <!-- Nombre de la sala -->
          <ion-item class="form-input" lines="none">
            <ion-label position="stacked">Nombre de la Sala *</ion-label>
            <ion-input 
              type="text" 
              [(ngModel)]="editRoom.name" 
              name="editRoomName"
              placeholder="Ej: Grupo Principiantes"
              required
              maxlength="50">
            </ion-input>
          </ion-item>

          <!-- Botones de acción -->
          <div class="modal-actions">
            <ion-button 
              expand="block" 
              type="button"
              fill="outline" 
              color="medium"
              (click)="closeEditModal()"
              class="cancel-button">
              Cancelar
            </ion-button>

            <ion-button 
              expand="block" 
              type="submit"
              [disabled]="!editRoomForm.valid || isEditing"
              class="create-button">
              <span *ngIf="!isEditing">Guardar Cambios</span>
              <span *ngIf="isEditing">Guardando...</span>
            </ion-button>
          </div>

        </form>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>