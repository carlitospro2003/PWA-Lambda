<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button (click)="cancel()"></ion-back-button>
    </ion-buttons>
    <ion-title>Agregar Ejercicio</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="saveExercise()" [disabled]="!isFormValid()">
        <ion-icon name="save-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="exercise-form-content">
  <div class="form-container">
    
    <!-- Información de la Sala -->
    <ion-card class="room-info-card">
      <ion-card-content>
        <div class="room-header">
          <ion-icon name="fitness-outline" class="room-icon"></ion-icon>
          <div>
            <h3>{{ roomName }}</h3>
            <p>Agregar nuevo ejercicio</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Formulario -->
    <ion-card class="form-card">
      <ion-card-content>
        
        <!-- Campo Obligatorio -->
        <div class="form-section">
          <h4>Información del Ejercicio</h4>
          
          <ion-item>
            <ion-label position="stacked">Título del Ejercicio *</ion-label>
            <ion-input 
              [(ngModel)]="exerciseForm.EXC_Title" 
              placeholder="Ej: Flexiones de pecho"
              maxlength="255"
              required>
            </ion-input>
          </ion-item>
        </div>

        <!-- Campos Opcionales -->
        <div class="form-section">
          <h4>Detalles Opcionales</h4>
          
          <ion-item>
            <ion-label position="stacked">Tipo de Ejercicio</ion-label>
            <ion-select 
              [(ngModel)]="exerciseForm.EXC_Type" 
              placeholder="Selecciona el tipo (opcional)"
              interface="popover">
              <ion-select-option *ngFor="let type of exerciseTypes" [value]="type.value">
                {{ type.label }}
              </ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Nivel de Dificultad</ion-label>
            <ion-select 
              [(ngModel)]="exerciseForm.EXC_DifficultyLevel" 
              placeholder="Selecciona la dificultad (opcional)"
              interface="popover">
              <ion-select-option *ngFor="let difficulty of difficultyLevels" [value]="difficulty.value">
                {{ difficulty.label }}
              </ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Instrucciones del Ejercicio</ion-label>
            <ion-textarea 
              [(ngModel)]="exerciseForm.EXC_Instructions" 
              placeholder="Describe las instrucciones del ejercicio (opcional)"
              rows="4">
            </ion-textarea>
          </ion-item>
        </div>

        <!-- Sección Multimedia -->
        <div class="form-section">
          <h4>Multimedia (Opcional)</h4>
          
          <!-- Media 1 -->
          <ion-item>
            <ion-label position="stacked">Imagen/Video 1</ion-label>
            <div class="file-input-wrapper">
              <input 
                #fileInput1
                type="file" 
                accept="image/jpeg,image/png,image/jpg,image/webp,video/mp4,video/mov"
                data-field="EXC_Media1"
                (change)="onFileSelected($event, 'EXC_Media1')"
                style="display: none;">
              <ion-button 
                fill="outline" 
                size="small"
                (click)="fileInput1.click()">
                <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
                Seleccionar
              </ion-button>
              <span class="file-name">{{ getFileName('EXC_Media1') }}</span>
              <ion-button 
                *ngIf="hasFile('EXC_Media1')"
                fill="clear" 
                size="small" 
                color="danger"
                (click)="removeFile('EXC_Media1')">
                <ion-icon name="close-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </ion-item>

          <!-- Media 2 -->
          <ion-item>
            <ion-label position="stacked">Imagen/Video 2</ion-label>
            <div class="file-input-wrapper">
              <input 
                #fileInput2
                type="file" 
                accept="image/jpeg,image/png,image/jpg,image/webp,video/mp4,video/mov"
                data-field="EXC_Media2"
                (change)="onFileSelected($event, 'EXC_Media2')"
                style="display: none;">
              <ion-button 
                fill="outline" 
                size="small"
                (click)="fileInput2.click()">
                <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
                Seleccionar
              </ion-button>
              <span class="file-name">{{ getFileName('EXC_Media2') }}</span>
              <ion-button 
                *ngIf="hasFile('EXC_Media2')"
                fill="clear" 
                size="small" 
                color="danger"
                (click)="removeFile('EXC_Media2')">
                <ion-icon name="close-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </ion-item>

          <!-- Media 3 -->
          <ion-item>
            <ion-label position="stacked">Imagen/Video 3</ion-label>
            <div class="file-input-wrapper">
              <input 
                #fileInput3
                type="file" 
                accept="image/jpeg,image/png,image/jpg,image/webp,video/mp4,video/mov"
                data-field="EXC_Media3"
                (change)="onFileSelected($event, 'EXC_Media3')"
                style="display: none;">
              <ion-button 
                fill="outline" 
                size="small"
                (click)="fileInput3.click()">
                <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
                Seleccionar
              </ion-button>
              <span class="file-name">{{ getFileName('EXC_Media3') }}</span>
              <ion-button 
                *ngIf="hasFile('EXC_Media3')"
                fill="clear" 
                size="small" 
                color="danger"
                (click)="removeFile('EXC_Media3')">
                <ion-icon name="close-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </ion-item>

          <!-- Media 4 -->
          <ion-item>
            <ion-label position="stacked">Imagen/Video 4</ion-label>
            <div class="file-input-wrapper">
              <input 
                #fileInput4
                type="file" 
                accept="image/jpeg,image/png,image/jpg,image/webp,video/mp4,video/mov"
                data-field="EXC_Media4"
                (change)="onFileSelected($event, 'EXC_Media4')"
                style="display: none;">
              <ion-button 
                fill="outline" 
                size="small"
                (click)="fileInput4.click()">
                <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
                Seleccionar
              </ion-button>
              <span class="file-name">{{ getFileName('EXC_Media4') }}</span>
              <ion-button 
                *ngIf="hasFile('EXC_Media4')"
                fill="clear" 
                size="small" 
                color="danger"
                (click)="removeFile('EXC_Media4')">
                <ion-icon name="close-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </ion-item>
        </div>

        <!-- URLs Externas -->
        <div class="form-section">
          <h4>URLs Externas (Opcional)</h4>
          
          <ion-item>
            <ion-label position="stacked">
              <ion-icon name="link-outline"></ion-icon>
              URL de Video 1 (YouTube, Vimeo, etc.)
            </ion-label>
            <ion-input 
              [(ngModel)]="exerciseForm.EXC_URL1" 
              type="url"
              placeholder="https://www.youtube.com/watch?v=..."
              maxlength="255">
            </ion-input>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">
              <ion-icon name="link-outline"></ion-icon>
              URL de Video 2
            </ion-label>
            <ion-input 
              [(ngModel)]="exerciseForm.EXC_URL2" 
              type="url"
              placeholder="https://..."
              maxlength="255">
            </ion-input>
          </ion-item>
        </div>

      </ion-card-content>
    </ion-card>

    <!-- Botones de acción -->
    <div class="action-buttons">
      <ion-button 
        expand="block" 
        fill="clear" 
        color="medium"
        (click)="cancel()">
        Cancelar
      </ion-button>
      
      <ion-button 
        expand="block" 
        [disabled]="!isFormValid()"
        (click)="saveExercise()">
        Guardar Ejercicio
      </ion-button>
    </div>

  </div>
</ion-content>