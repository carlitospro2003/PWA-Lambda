<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Ejercicios Guardados</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="clearAllFavorites()" fill="clear" color="danger">
        <ion-icon name="trash-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Guardados</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="page-content">
    <!-- Offline Status Indicator -->
    <ion-item lines="none" class="offline-status" *ngIf="!isOnline">
      <ion-icon name="cloud-offline-outline" slot="start" color="warning"></ion-icon>
      <ion-label>
        <h3>Modo Offline</h3>
        <p>Mostrando ejercicios guardados localmente</p>
      </ion-label>
    </ion-item>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="cachedFavorites.length === 0">
      <ion-icon name="heart-outline" class="empty-icon"></ion-icon>
      <h2 class="empty-title">Sin Ejercicios Guardados</h2>
      <p class="empty-subtitle">
        Marca ejercicios como favoritos en la vista Home para guardarlos offline
      </p>
      <ion-button [routerLink]="'/tabs/home'" fill="outline" color="primary">
        <ion-icon name="home-outline" slot="start"></ion-icon>
        Ir a Inicio
      </ion-button>
    </div>

    <!-- Favorites Count -->
    <ion-item lines="none" class="favorites-count" *ngIf="cachedFavorites.length > 0">
      <ion-icon name="heart" slot="start" color="danger"></ion-icon>
      <ion-label>
        <h3>{{ cachedFavorites.length }} ejercicios guardados</h3>
        <p>Disponibles sin conexi贸n</p>
      </ion-label>
      <ion-chip color="primary" slot="end">
        <ion-label>{{ getTotalEstimatedTime() }} min</ion-label>
      </ion-chip>
    </ion-item>

    <!-- Quick Action Buttons -->
    <div class="quick-actions" *ngIf="cachedFavorites.length > 0">
      <ion-button expand="block" fill="solid" color="primary" (click)="startRandomWorkout()">
        <ion-icon name="shuffle-outline" slot="start"></ion-icon>
        Rutina Aleatoria
      </ion-button>
      
      <ion-button expand="block" fill="outline" color="success" (click)="startAllFavorites()">
        <ion-icon name="play-circle-outline" slot="start"></ion-icon>
        Todos los Ejercicios
      </ion-button>
    </div>

    <!-- Cached Favorites List -->
    <div class="favorites-list" *ngIf="cachedFavorites.length > 0">
      <ion-card *ngFor="let favorite of cachedFavorites; trackBy: trackByFavoriteId" 
               class="favorite-card" 
               [class.completed]="isExerciseCompleted(favorite.ROU_ID)">
        <ion-card-content>
          <div class="exercise-header">
            <div class="exercise-info">
              <h3 class="exercise-title">{{ favorite.exercise.EXC_Title }}</h3>
              <div class="exercise-meta">
                <ion-chip color="tertiary" outline="true">
                  <ion-icon name="time-outline"></ion-icon>
                  <ion-label>{{ favorite.exercise.EXC_StimatedTime }} min</ion-label>
                </ion-chip>
                <ion-chip color="medium" outline="true" *ngIf="favorite.lastAccessedOffline">
                  <ion-icon name="download-outline"></ion-icon>
                  <ion-label>{{ getLastAccessedTime(favorite.lastAccessedOffline) }}</ion-label>
                </ion-chip>
              </div>
            </div>
            
            <div class="exercise-actions">
              <ion-button fill="clear" color="danger" (click)="removeFavorite(favorite)" size="small">
                <ion-icon name="heart-dislike-outline"></ion-icon>
              </ion-button>
            </div>
          </div>

          <div class="exercise-instructions">
            <p>{{ favorite.exercise.EXC_Instructions }}</p>
          </div>

          <!-- Progress indicator for completed exercises -->
          <div class="completion-status" *ngIf="isExerciseCompleted(favorite.ROU_ID)">
            <ion-chip color="success" fill="solid">
              <ion-icon name="checkmark-circle"></ion-icon>
              <ion-label>Completado Offline</ion-label>
            </ion-chip>
          </div>

          <div class="exercise-footer">
            <ion-button expand="block" 
                        [color]="isExerciseCompleted(favorite.ROU_ID) ? 'medium' : 'primary'"
                        [fill]="isExerciseCompleted(favorite.ROU_ID) ? 'outline' : 'solid'"
                        (click)="startExercise(favorite)">
              <ion-icon [name]="isExerciseCompleted(favorite.ROU_ID) ? 'refresh-outline' : 'play-outline'" slot="start"></ion-icon>
              {{ isExerciseCompleted(favorite.ROU_ID) ? 'Repetir' : 'Iniciar' }}
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Cache Info -->
    <ion-card class="cache-info" *ngIf="cachedFavorites.length > 0">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="information-circle-outline"></ion-icon>
          Informaci贸n de Cache
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item>
            <ion-icon name="save-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>Guardado Local</h3>
              <p>{{ getLastSyncTime() }}</p>
            </ion-label>
          </ion-item>
          
          <ion-item>
            <ion-icon name="folder-outline" slot="start" color="medium"></ion-icon>
            <ion-label>
              <h3>Espacio Utilizado</h3>
              <p>{{ getCacheSize() }}</p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-icon name="sync-outline" slot="start" color="success"></ion-icon>
            <ion-label>
              <h3>Sincronizaci贸n</h3>
              <p>{{ getSyncStatus() }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
        
        <ion-button expand="block" fill="outline" color="medium" (click)="syncWithServer()" [disabled]="!isOnline">
          <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
          {{ isOnline ? 'Sincronizar con Servidor' : 'Sin Conexi贸n' }}
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>