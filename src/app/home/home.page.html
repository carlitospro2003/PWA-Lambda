<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Mis Salas</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="home-content">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Mis Salas</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="home-container">
    
    <!-- Header con saludo -->
    <div class="user-welcome">
      <h2>¡Hola, {{ userName }}!</h2>
      <p>Estas son las salas en las que participas</p>
    </div>

    <!-- Buscador de salas -->
    <div class="search-section">
      <h3 class="search-title">Buscar una sala</h3>
      <p class="search-subtitle">Ingresa el código de 7 caracteres</p>
      
      <div class="search-container">
        <ion-searchbar
          [(ngModel)]="searchCode"
          placeholder="Ej: ROOM001"
          [maxlength]="7"
          (keyup.enter)="searchRoom()"
          class="room-searchbar">
        </ion-searchbar>
        
        <ion-button 
          expand="block" 
          (click)="searchRoom()"
          [disabled]="isSearching || searchCode.length !== 7"
          class="search-button">
          <ion-icon name="search-outline" slot="start" *ngIf="!isSearching"></ion-icon>
          <ion-spinner name="crescent" *ngIf="isSearching"></ion-spinner>
          <span *ngIf="!isSearching">Buscar</span>
          <span *ngIf="isSearching">Buscando...</span>
        </ion-button>
      </div>

      <!-- Resultado de la búsqueda -->
      <div class="search-result" *ngIf="searchedRoom">
        <ion-card class="found-room-card">
          <ion-card-content>
            <div class="found-room-header">
              <div class="found-room-info">
                <h4 class="found-room-name">{{ searchedRoom.ROO_Name }}</h4>
                <ion-chip color="success" size="small">
                  <ion-label>{{ searchedRoom.ROO_Code }}</ion-label>
                </ion-chip>
              </div>
              <ion-button 
                (click)="clearSearch()" 
                fill="clear" 
                size="small"
                class="clear-btn">
                ✕
              </ion-button>
            </div>
            
            <div class="found-room-actions">
              <ion-button 
                expand="block" 
                (click)="joinSearchedRoom()"
                [disabled]="isSearching"
                class="join-button">
                <ion-icon name="arrow-forward-circle-outline" slot="start" *ngIf="!isSearching"></ion-icon>
                <ion-spinner name="crescent" *ngIf="isSearching"></ion-spinner>
                <span *ngIf="!isSearching">Unirse a esta sala</span>
                <span *ngIf="isSearching">Uniéndose...</span>
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- Lista de salas del usuario -->
    <div class="rooms-grid">
      <ion-card 
        class="room-card" 
        *ngFor="let room of userRooms"
        (click)="enterRoom(room)">
        <ion-card-content>
          
          <!-- Header de la sala -->
          <div class="room-header">
            <h3 class="room-name">{{ room.name }}</h3>
            <ion-chip color="primary" size="small">
              <ion-label>{{ room.code }}</ion-label>
            </ion-chip>
          </div>

          <!-- Información de la sala -->
          <div class="room-info">
            <!-- Miembros totales -->
            <div class="info-item">
              <div class="info-icon-container">
                <ion-icon name="people-outline" class="info-icon"></ion-icon>
              </div>
              <div class="info-content">
                <span class="info-label">Miembros</span>
                <span class="info-value">{{ room.totalMembers }}</span>
              </div>
            </div>
            
            <!-- Ejercicios disponibles -->
            <div class="info-item">
              <div class="info-icon-container">
                <ion-icon name="fitness-outline" class="info-icon"></ion-icon>
              </div>
              <div class="info-content">
                <span class="info-label">Ejercicios</span>
                <span class="info-value">{{ room.totalExercises }}</span>
              </div>
            </div>
          </div>

          <!-- Botón de acción -->
          <div class="action-section">
            <div class="enter-button" (click)="enterRoom(room); $event.stopPropagation()">
              <ion-icon name="arrow-forward-circle-outline" class="action-icon"></ion-icon>
              <span>Entrar a la sala</span>
            </div>
            
            <ion-button 
              fill="clear" 
              color="danger" 
              size="small"
              (click)="leaveRoom(room, $event)"
              class="leave-room-btn">
              <ion-icon name="exit-outline" slot="start"></ion-icon>
              Salir de la sala
            </ion-button>
          </div>

        </ion-card-content>
      </ion-card>
    </div>

    <!-- Estado vacío si no hay salas -->
    <div class="empty-state" *ngIf="userRooms.length === 0">
      <ion-icon name="people-outline" class="empty-icon"></ion-icon>
      <h3>No estás en ninguna sala</h3>
      <p>Pídele a tu entrenador el código de una sala para unirte</p>
    </div>

  </div>
</ion-content>